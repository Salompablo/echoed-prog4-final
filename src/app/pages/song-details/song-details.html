@if (!isLoading) {
@if (loadError()) {
<div class="song-detail-container">
  <div class="error-alert">
    {{ loadError() }}
  </div>
</div>
} @else if (song) {
<section class="song-detail-container">
  <div class="song-header-block card">
    <div class="cover-container">
      <img [src]="song.imageUrl" [alt]="'Cover of ' + song.albumName" class="album-cover">
    </div>

    <div class="metadata-info">
      <span class="music-type">{{"song-details.song" | translate}}</span>

      <h1>{{ song.name }}
        @if(song.explicit){
        <span class="material-symbols-rounded">
          explicit
        </span> }
      </h1>

      <p class="artist-name">
        <a [routerLink]="['/artists', song.artistSpotifyId]">{{ song.artistName }}</a>
      </p>
      <p class="album-name">
        <a [routerLink]="['/albums', song.albumSpotifyId]">{{ song.albumName }}</a>
      </p>

      <div class="song-meta">
        <span>{{"song-details.release-date" | translate}}<span class="meta-value">{{ song.releaseDate}} </span></span>
        <span> | </span>
        <span>{{"song-details.duration" | translate}}<span class="meta-value">{{ formatDuration(song.durationMs) }}</span></span>
        <span> | </span>
        <span> <a href={{song.spotifyLink}} target="_blank">{{"song-details.spotify" | translate}}</a></span>

      </div>
      <button class="primary write-review-btn" (click)="openReviewModal()">
        {{"song-details.echo" | translate}}
      </button>
    </div>
  </div>

  <div class="community-reviews">
    <h2>{{"song-details.echoes" | translate}}</h2>
    <app-review-list
      [reviews]="reviews()"
      [loading]="isLoadingReviews()"
      [showMusicInfo]="false"
      [showUserAvatar]="true"
      [emptyMessage]="'song-details.empty' | translate"
      (reviewDeleted)="onReviewDeleted($event)"
      (reviewEditRequest)="onReviewEditRequest($event)" />
  </div>
</section>

@if (isModalOpen() && song) {
<app-review-modal [type]="'song'" [item]="song" [existingReview]="reviewToEdit()" [isSubmitting]="isSubmittingReview()" (closed)="closeReviewModal()" (submitted)="handleReviewSubmit($event)">
</app-review-modal>
}
}
}@else {
<app-loading-spinner [message]="'song-details.loading' | translate"></app-loading-spinner>
}