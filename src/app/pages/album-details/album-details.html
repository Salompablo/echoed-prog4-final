@if (!isLoading) {
@if (loadError()) {
<div class="album-detail-container">
  <div class="error-alert">
    {{ loadError() }}
  </div>
</div>
} @else if (album) {
<section class="album-detail-container">
  <div class="album-header-block card">
    <div class="cover-container">
      <img [src]="album.imageUrl" [alt]="'Cover of ' + album.title" class="album-cover">
    </div>

    <div class="metadata-info">
      <span class="music-type">{{ "album-details.album" | translate}}</span>

      <h1>{{ album.title }}</h1>

      <p class="artist-name">
        <a [routerLink]="['/artists', album.artistSpotifyId]">{{ album.artistName }}</a>
      </p>

      <div class="album-meta">
        <span>{{ "album-details.release-date" | translate}}<span class="meta-value">{{ album.releaseDate}}
          </span></span>
        <span> | </span>
        <span> <a href={{album.spotifyLink}} target="_blank">{{ "album-details.spotify" | translate}}</a></span>

      </div>
      <div class="album-btn">
        <button class="primary write-review-btn" (click)="openReviewModal()">
          {{ "album-details.echo" | translate}}
        </button>
        <button class="primary write-review-btn" (click)="openTracklist()">
          {{ showTracks ? ('album-details.hide-tracks' | translate) : ('album-details.show-tracks' | translate) }}
        </button>
      </div>
    </div>
  </div>

  <div class="track-section card" [class.is-open]="showTracks">
    <h2>{{ "album-details.tracks" | translate}}</h2>
    <ol class="track-list">
      <li class="track-header">
        <span class="track-number">#</span>
        <span class="track-title-header">{{ "album-details.title" | translate}}</span>
        <span class="track-duration">{{ "album-details.duration" | translate}}</span>
      </li>
      @for (track of album.songs; track track.spotifyId; let i = $index) {
      <li class="track-row" [routerLink]="['/songs', track.spotifyId]">
        <span class="track-number">{{ i + 1 }}</span>
        <div class="track-info">
          <span class="track-title">{{ track.name }}
            @if(track.explicit){
            <span class="material-symbols-rounded">explicit</span>
            }
          </span>
          <span class="track-artist">{{ track.artistName }}</span>

        </div>

        <span class="track-duration">{{ formatDuration(track.durationMs) }}</span>
      </li>
      } @empty {
      <p class="empty-list-message">{{ "album-details.no-tracks-found" | translate}}</p>
      }
    </ol>
  </div>




  <div class="community-reviews">
    <h2>{{ "album-details.echoes" | translate}}</h2>
    <app-review-list [reviews]="reviews()" [loading]="isLoadingReviews()" [showMusicInfo]="false"
      [showUserAvatar]="true" [emptyMessage]="'album-details.empty' | translate"
      (reviewDeleted)="onReviewDeleted($event)" (reviewEditRequest)="onReviewEditRequest($event)"></app-review-list>

  </div>
</section>

@if (isModalOpen() && album) {
<app-review-modal [type]="'album'" [item]="album" [existingReview]="reviewToEdit()"
  [isSubmitting]="isSubmittingReview()" (closed)="closeReviewModal()" (submitted)="handleReviewSubmit($event)">
</app-review-modal>
}
}
}@else {
<app-loading-spinner [message]="'album-details.loading' | translate"></app-loading-spinner>
}