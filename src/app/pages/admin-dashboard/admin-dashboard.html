<div class="admin-container">
    <h2 class="dashboard-title">{{ 'admin-dashboard.title' | translate }}</h2>

    <div class="controls-bar">
        <div class="search-wrapper">
            <span class="material-symbols-rounded search-icon">search</span>
            <input type="text" class="search-input" [placeholder]="'admin-dashboard.search-placeholder' | translate"
                [ngModel]="searchQuery()" (ngModelChange)="onSearchQueryChange($event)">
        </div>
    </div>

    <div class="table-responsive-wrapper">
        <table class="admin-table">
            <thead>
                <tr>
                    <th>
                        <div class="sortable-header" (click)="onSort('id')">
                            {{ 'admin-dashboard.col-id' | translate }}
                            <span class="material-symbols-rounded sort-icon">{{ getSortIcon('id') }}</span>
                        </div>
                    </th>
                    <th>
                        <div class="sortable-header" (click)="onSort('username')">
                            {{ 'admin-dashboard.col-user' | translate }}
                            <span class="material-symbols-rounded sort-icon">{{ getSortIcon('username') }}</span>
                        </div>
                    </th>
                    <th>{{ 'admin-dashboard.col-role' | translate }}</th>
                    <th>{{ 'admin-dashboard.col-status' | translate }}</th>
                    <th class="actions-th">{{ 'admin-dashboard.col-actions' | translate }}</th>
                </tr>
            </thead>
            <tbody>
                @for (user of users(); track user.id) {
                <tr>
                    <td>#{{ user.id }}</td>
                    <td>
                        <div style="display: flex; align-items: center; gap: 0.75rem;">
                            <img [src]="user.profilePictureUrl ? 'assets/images/default-avatars/' + user.profilePictureUrl : 'assets/default-avatar.svg'"
                                [alt]="user.username"
                                style="width: 2.5rem; height: 2.5rem; border-radius: 50%; object-fit: cover;">

                            <div style="display: flex; flex-direction: column;">
                                <span style="font-weight: 700;">{{ user.username }}</span>
                                <span style="font-size: 0.85rem; color: var(--secondary-color);">{{ user.email }}</span>
                            </div>
                        </div>
                    </td>

                    <td>
                        <div class="role-pills">
                            @for (role of user.roles; track role) {
                            <span class="role-pill" [class.role-role_admin]="role === 'ROLE_ADMIN'">
                                {{ role.replace('ROLE_', '') }}
                            </span>
                            }
                        </div>
                    </td>

                    <td>
                        @if (user.active) {
                        <span class="status-indicator status-active">
                            {{ 'admin-dashboard.status-active' | translate }}
                        </span>
                        } @else {
                        <span class="status-indicator status-deactivated">
                            {{ 'admin-dashboard.status-deactivated' | translate }}
                        </span>
                        }
                    </td>

                    <td class="actions-cell">
                        @if (user.active) {
                        <button class="action-btn ban-btn" (click)="onBanUser(user.id)"
                            [disabled]="isActionLoading(user.id) || authService.currentUser()?.userId === user.id"
                            [title]="authService.currentUser()?.userId === user.id ? 'You cannot ban yourself' : ''">

                            @if (isActionLoading(user.id)) {
                            <span class="button-spinner"></span>
                            <span>{{ 'admin-dashboard.btn-banning' | translate }}</span>
                            } @else {
                            <span class="material-symbols-rounded"
                                style="margin-right: 0.3rem; font-size: 1.1rem;">gavel</span>
                            <span>{{ 'admin-dashboard.btn-ban' | translate }}</span>
                            }
                        </button>
                        } @else {
                        <button class="action-btn unban-btn" (click)="onUnbanUser(user.id)"
                            [disabled]="isActionLoading(user.id)">

                            @if (isActionLoading(user.id)) {
                            <span class="button-spinner"></span>
                            <span>{{ 'admin-dashboard.btn-unbanning' | translate }}</span>
                            } @else {
                            <span class="material-symbols-rounded"
                                style="margin-right: 0.3rem; font-size: 1.1rem;">lock_open</span>
                            <span>{{ 'admin-dashboard.btn-unban' | translate }}</span>
                            }
                        </button>
                        }
                    </td>
                </tr>
                } @empty {
                <tr>
                    <td colspan="5" class="no-results-row">
                        <div class="empty-state-card">
                            <span class="material-symbols-rounded"
                                style="font-size: 2rem; color: var(--secondary-color);">search_off</span>
                            <p>{{ 'search-bar.no-results' | translate }} "{{ searchQuery() }}"</p>
                        </div>
                    </td>
                </tr>
                }
            </tbody>
        </table>
    </div>

    @if (totalPages() > 1) {
    <div class="pagination-footer">
        <button class="page-btn" (click)="onPageChange(currentPage() - 1)" [disabled]="currentPage() === 0">
            <span class="material-symbols-rounded">chevron_left</span>
        </button>

        @for (page of pagesArray(); track page) {
        <button class="page-btn" [class.active]="currentPage() === page" (click)="onPageChange(page)">
            {{ page + 1 }}
        </button>
        }

        <button class="page-btn" (click)="onPageChange(currentPage() + 1)"
            [disabled]="currentPage() >= totalPages() - 1">
            <span class="material-symbols-rounded">chevron_right</span>
        </button>
    </div>
    }
</div>