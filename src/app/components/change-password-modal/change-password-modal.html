<div class="modal-backdrop" (click)="onBackdropClick($event)">
    <div class="modal-content card">
        <h3 class="modal-title">Change Password</h3>
        <p>
            Enter your current password and a new one.
        </p>

        <form [formGroup]="passwordForm" (ngSubmit)="onConfirmChange()">

            <div class="form-group">
                <label for="currentPassword">Current Password</label>
                <input [type]="passwordsHidden() ? 'password' : 'text'" id="currentPassword"
                    formControlName="currentPassword" class="form-input"
                    [class.input-error]="currentPassword?.invalid && currentPassword?.touched" />
                @if (currentPassword?.invalid && currentPassword?.touched) {
                <div class="error-validation">
                    <small>Current password is required.</small>
                </div>
                }
            </div>

            <div class="form-group">
                <label for="newPassword">New Password</label>
                <input [type]="passwordsHidden() ? 'password' : 'text'" id="newPassword" formControlName="newPassword"
                    class="form-input" [class.input-error]="newPassword?.invalid && newPassword?.touched" />
                @if (newPassword?.invalid && newPassword?.touched) {
                <div class="error-validation">
                    @if (newPassword?.errors?.['required']) { <small>New password is required.</small> }
                    @if (newPassword?.errors?.['minlength']) { <small>Must be at least 8 characters.</small> }
                </div>
                }
            </div>

            <div class="form-group">
                <label for="confirmPassword">Confirm New Password</label>
                <input [type]="passwordsHidden() ? 'password' : 'text'" id="confirmPassword"
                    formControlName="confirmPassword" class="form-input"
                    [class.input-error]="(confirmPassword?.invalid && confirmPassword?.touched) || passwordForm.errors?.['passwordMismatch']" />
                @if (confirmPassword?.invalid && confirmPassword?.touched) {
                <div class="error-validation">
                    <small>Please confirm your new password.</small>
                </div>
                }
                @if (passwordForm.errors?.['passwordMismatch'] && confirmPassword?.touched) {
                <div class="error-validation">
                    <small>Passwords do not match.</small>
                </div>
                }
            </div>

            <div class="form-check">
                <button type="button" class="button-as-link" (click)="togglePasswordsVisibility()">
                    @if (passwordsHidden()) {
                    <span class="material-symbols-rounded">visibility</span> Show passwords
                    } @else {
                    <span class="material-symbols-rounded">visibility_off</span> Hide passwords
                    }
                </button>
            </div>
            @if (errorMessage()) {
            <div class="error-api">
                {{ errorMessage() }}
            </div>
            }

            <div class="modal-actions">
                <button type="button" class="button secondary" (click)="onCancel()" [disabled]="isLoading()">
                    Cancel
                </button>
                <button type="submit" class="button primary" [disabled]="passwordForm.invalid || isLoading()">
                    @if (isLoading()) {
                    <span>Saving...</span>
                    } @else {
                    <span>Save</span>
                    }
                </button>
            </div>
        </form>
    </div>
</div>