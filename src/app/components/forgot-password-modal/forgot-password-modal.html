<div class="modal-backdrop" (click)="onBackdropClick($event)">
    <div class="modal-content card">
        <h3 class="modal-title">{{ "forgot-password.title" | translate }}</h3>

        @if (step() === 1) {
        <p>{{ "forgot-password.step-1-desc" | translate }}</p>

        <form [formGroup]="emailForm" (ngSubmit)="onSubmitEmail()">
            <div class="form-group">
                <label for="email">{{ "forgot-password.email-label" | translate }}</label>
                <input type="email" id="email" formControlName="email" class="form-input"
                    [class.input-error]="email?.invalid && email?.touched" />

                @if (email?.invalid && email?.touched) {
                <div class="error-validation">
                    @if(email?.errors?.['required']) { <small>{{ "forgot-password.email-required" | translate }}</small>
                    }
                    @if(email?.errors?.['email']) { <small>{{ "forgot-password.email-invalid" | translate }}</small> }
                </div>
                }
            </div>

            @if (errorMessage()) {
            <div class="error-api">{{ errorMessage() }}</div>
            }

            <div class="modal-actions">
                <button type="button" class="button secondary" (click)="onCancel()" [disabled]="isLoading()">
                    {{ "forgot-password.cancel" | translate }}
                </button>
                <button type="submit" class="button primary" [disabled]="emailForm.invalid || isLoading()">
                    @if(isLoading()){
                    <span class="button-spinner"></span>
                    <span>{{ "forgot-password.sending" | translate }}</span>
                    } @else {
                    <span>{{ "forgot-password.send-code" | translate }}</span>
                    }
                </button>
            </div>
        </form>
        }

        @if (step() === 2) {
        <p>{{ "forgot-password.step-2-desc" | translate }}</p>

        <form [formGroup]="resetForm" (ngSubmit)="onSubmitReset()">

            <div class="form-group">
                <label for="token">{{ "forgot-password.code-label" | translate }}</label>
                <input type="text" id="token" formControlName="token" class="form-input input-token" placeholder="XXXXXX" />
                @if (token?.invalid && token?.touched) {
                <div class="error-validation"><small>{{ "forgot-password.code-required" | translate }}</small></div>
                }
            </div>

            <div class="form-group">
                <label for="newPassword">{{ "forgot-password.new-password" | translate }}</label>

                <div class="password-input-wrapper">
                    <input [type]="passwordsHidden() ? 'password' : 'text'" id="newPassword" formControlName="password"
                        class="form-input" />
                </div>

                @if (password?.invalid && password?.touched) {
                <div class="error-validation">
                    @if(password?.errors?.['required']) { <small>{{ "forgot-password.password-required" | translate
                        }}</small> }
                    @if(password?.errors?.['minlength']) { <small>{{ "forgot-password.password-minlength" | translate
                        }}</small> }
                </div>
                }


            </div>

            <div class="form-group">
                <label for="confirmPassword">{{ "forgot-password.confirm-password" | translate }}</label>

                <div class="password-input-wrapper">
                    <input [type]="passwordsHidden() ? 'password' : 'text'" id="confirmPassword"
                        formControlName="confirmPassword" class="form-input" />
                </div>

                @if (resetForm.errors?.['passwordMismatch'] && confirmPassword?.touched) {
                <div class="error-validation"><small>{{ "forgot-password.password-mismatch" | translate }}</small></div>
                }
            </div>

            @if (errorMessage()) {
            <div class="error-api">{{ errorMessage() }}</div>
            }

            <button type="button" class="button-as-link" (click)="togglePasswordsVisibility()">
                @if (passwordsHidden()) {
                <span>{{ "login.show" | translate }}</span>
                } @else {
                <span>{{ "login.hide" | translate }}</span>
                }
            </button>

            <div class="modal-actions">
                <button type="button" class="button secondary" (click)="step.set(1)" [disabled]="isLoading()">
                    {{ "forgot-password.back" | translate }}
                </button>
                <button type="submit" class="button primary" [disabled]="resetForm.invalid || isLoading()">
                    @if(isLoading()){
                    <span class="button-spinner"></span>
                    <span>{{ "forgot-password.resetting" | translate }}</span>
                    } @else {
                    <span>{{ "forgot-password.reset-password" | translate }}</span>
                    }
                </button>
            </div>
        </form>
        }
    </div>
</div>