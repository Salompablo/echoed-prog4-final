<div class="modal-backdrop" (click)="onBackdropClick($event)">
  <div class="modal-content card" (click)="$event.stopPropagation()">
    <h3 class="modal-title">{{modalTitle()}}</h3>
    <button type="button" class="close-button" (click)="onCancel()" aria-label="Close modal">
      Ã—
    </button>

    <form [formGroup]="commentForm" (ngSubmit)="onSubmit()" class="comment-form">
      <div class="form-group">
        <label for="comment-text">Your Comment</label>
        <textarea
          id="comment-text"
          formControlName="text"
          [placeholder]="'What do you think?'"
          rows="5"
          [maxlength]="MAX_CHARS"
          [class.input-error]="text?.invalid && text?.touched"
        ></textarea>
        
        <div class="character-counter">
          {{ characterCount() }} / {{ MAX_CHARS }}
        </div>
        
        @if (text?.invalid && text?.touched) {
          <div class="error-validation">
            @if (text?.errors?.['required']) { <small>Comment cannot be empty.</small> }
            @if (text?.errors?.['minlength']) { <small>Must be at least 3 characters.</small> }
          </div>
        }
      </div>

      @if (errorMessage()) {
        <div class="error-api">
          {{ errorMessage() }}
        </div>
      }

      <div class="modal-actions">
        <button type="button" class="button secondary" (click)="onCancel()" [disabled]="isLoading()">
          Cancel
        </button>
        <button type="submit" class="button primary" [disabled]="commentForm.invalid || isLoading()">
          @if (isLoading()) {
            <span> {{commentToEdit ? 'Saving...' : 'Submitting...'}} </span>
          } @else {
            <span> {{commentToEdit ? 'Save changes' : 'Submit Comment'}} </span>
          }
        </button>
      </div>
    </form>
  </div>
</div>